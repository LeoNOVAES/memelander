/*
 * @web-scrobbler/metadata-filter v3.2.0
 * (c) Web Scrobbler MetadataFilter Team
 * Licensed under the MIT License
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).MetadataFilter={})}(this,(function(e){"use strict";function r(e){Array.isArray(e)?e.forEach(t):t(e)}function t(e){if("function"!=typeof e)throw new TypeError(`Invalid filter function: expected 'function', got '${typeof e}'`)}class i{constructor(e){this.mergedFilterSet={},this.appendFilters(e)}filterField(e,r){if(e in this.mergedFilterSet)return this.filterText(r,this.mergedFilterSet[e]);throw new TypeError(`Invalid filter field: ${e}`)}append(e){return this.appendFilters(e),this}extend(e){if(!e)throw new TypeError("No filter is specified!");if(!(e instanceof i))throw new TypeError(`Invalid filter: expected 'MetadataFilter', got '${typeof e}'`);return this.appendFilters(e.mergedFilterSet),this}canFilterField(e){return e in this.mergedFilterSet}getFields(){return Object.keys(this.mergedFilterSet)}filterText(e,r){return e?r.reduce(((e,r)=>r(e)),e):e}wrapFiltersIntoArray(e){if(Array.isArray(e))return e;return[e]}appendFilters(e){!function(e){if(!e)throw new TypeError("No filter set is specified!");if("object"!=typeof e)throw new TypeError(`Invalid filter set: expected 'object', got '${typeof e}'`);for(const t in e)r(e[t])}(e);for(const r in e){r in this.mergedFilterSet||(this.mergedFilterSet[r]=[]);const t=this.wrapFiltersIntoArray(e[r]);this.mergedFilterSet[r].push(...t)}}}const s=[{source:/\s[([]Explicit[)\]]/i,target:""},{source:/\s[([]Clean[)\]]/i,target:""}],o=[{source:/\s[([]feat. .+[)\]]/i,target:""},{source:/\s(feat. .+)/i,target:""}],n=[{source:/\s-\sLive(\s.+)?$/,target:""},{source:/\s[([]Live[)\]]$/,target:""}],a=[{source:/\s[([](feat. .+)[)\]]/i,target:" $1"}],u=[{source:/\s\(Parody of ".*" by .*\)$/,target:""},{source:/\s\(Parody of ".*" by .* feat\. .*\)$/,target:""},{source:/\s\(Lyrical Adaption of ".*"\)$/,target:""}],c=[{source:/\sRe-?issue$/i,target:""},{source:/\s\[.*?Re-?issue.*?\]/i,target:""},{source:/\s\(.*?Re-?issue.*?\)/i,target:""}],l=[{source:/Live\s\/\sRemastered/,target:"Live"},{source:/\s[([].*Re-?[Mm]aster(ed)?.*[)\]]$/,target:""},{source:/\s-\s\d{4}(\s-)?\s.*Re-?[Mm]aster(ed)?.*$/,target:""},{source:/\s-\sRe-?[Mm]aster(ed)?.*$/,target:""},{source:/\s\[Remastered\]\s\(Remastered\sVersion\)$/,target:""}],g=[{source:/-\s(.+?)\s((Re)?mix|edit|dub|mix|vip|version)$/i,target:"($1 $2)"},{source:/-\s(Remix|VIP|Instrumental)$/i,target:"($1)"}],f=[{source:/\(+\s*\)+/,target:""},{source:/^[/,:;~\s"-]+/,target:""},{source:/[/,:;~\s"-]+$/,target:""},{source:/\u0020{1,}/,target:" "}],d=[{source:/(Various Artists).+/,target:"$1"}],p=[{source:/\s[([]Album Version[)\]]$/,target:""},{source:/\s[([]Re-?recorded[)\]]$/,target:""},{source:/\s[([]Single Version[)\]]$/,target:""},{source:/\s[([]Edit[)\]]$/,target:""},{source:/\s-\sMono Version$/,target:""},{source:/\s-\sStereo Version$/,target:""},{source:/\s\(Deluxe Edition\)$/,target:""},{source:/\s[([]Expanded.*[)\]]$/,target:""},{source:/\s-\sExpanded Edition$/,target:""},{source:/\s[([]Explicit Version[)\]]/i,target:""},{source:/\s[([]Bonus Track Edition[)\]]/i,target:""},{source:/\s[([]\d+th\sAnniversary.*[)\]]/i,target:""},{source:/\s-\sOriginal$/i,target:""},{source:/\s-\sOriginal.*Version(\s\d{4})?$/i,target:""}],m=[{source:/^\s+|\s+$/g,target:""},{source:/\*+\s?\S+\s?\*+$/,target:""},{source:/\[[^\]]+\]/,target:""},{source:/【[^\]]+】/,target:""},{source:/（[^\]]+）/,target:""},{source:/\([^)]*version\)$/i,target:""},{source:/\.(avi|wmv|mpg|mpeg|flv)$/i,target:""},{source:/\(.*lyrics?\s*(video)?\)/i,target:""},{source:/\((of+icial\s*)?(track\s*)?stream\)/i,target:""},{source:/\((of+icial\s*)?(music\s*)?(video|audio)\)/i,target:""},{source:/-\s(of+icial\s*)?(music\s*)?(video|audio)$/i,target:""},{source:/\(.*Album\sTrack\)/i,target:""},{source:/\(\s*of+icial\s*\)/i,target:""},{source:/\(\s*[0-9]{4}\s*\)/i,target:""},{source:/\(\s*(HD|HQ)\s*\)$/,target:""},{source:/(HD|HQ)\s?$/,target:""},{source:/(vid[\u00E9e]o)?\s?clip\sof+ici[ae]l/i,target:""},{source:/of+iziel+es\s*video/i,target:""},{source:/vid[\u00E9e]o\s?clip/i,target:""},{source:/\sclip/i,target:""},{source:/full\s*album/i,target:""},{source:/\(live.*?\)$/i,target:""},{source:/\|.*$/i,target:""},{source:/^(|.*\s)"(.{5,})"(\s.*|)$/,target:"$2"},{source:/^(|.*\s)'(.{5,})'(\s.*|)$/,target:"$2"},{source:/\(.*[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{2,4}.*\)/i,target:""},{source:/sub\s*español/i,target:""},{source:/\s\(Letra\)/i,target:""},{source:/\s\(En\svivo\)/i,target:""},{source:/sub\s*español/i,target:""}],$=[{source:/\s(& .+)/i,target:""},{source:/\s(x .+)/i,target:""}],y={"&":/&amp;/g,"<":/&lt;/g,">":/&gt;/g,'"':/&quot;/g};function v(e){return e.includes(" feat. ")?e.split(" feat. ")[0]:e}function F(e){let r=e;for(const e in y){const t=y[e];r=r.replace(t,e)}return r=r.replace(/&#x([a-fA-f0-9]+);/g,((e,r)=>{const t=parseInt(r,16);return String.fromCharCode(t)})),r=r.replace(/&#(\d+);/g,((e,r)=>String.fromCharCode(r))),r}function h(e,r){return r.reduce(((e,r)=>{const{source:t,target:i}=r;return e.replace(t,i)}),e)}function w(e){return h(e,g)}function x(e){return h(e,a)}function E(e){return h(e,s)}function b(e){return h(e,o)}function A(e){return h(e,n)}function S(e){return h(e,u)}function T(e){return h(e,c)}function R(e){return h(e,l)}function I(e){return h(e,p)}function V(e){return h(e,[...m,...f])}e.MetadataFilter=i,e.albumArtistFromArtist=v,e.createAmazonFilter=function(){return new i({artist:[x],track:[E,b,R,w,I,A],album:[F,E,R,w,I,A],albumArtist:[x,v]})},e.createFilter=function(e){return new i(e)},e.createFilterSetForFields=function(e,t){return function(e){if(!Array.isArray(e))throw new TypeError(`Invalid 'fields' argument: expected 'string[]', got '${typeof e}'`);if(0===e.length)throw new Error("Invalid 'fields' argument: received an empty array");for(const r of e){if("string"!=typeof r)throw new TypeError(`Invalid field: expected 'string', got '${typeof r}'`);if(!r)throw new TypeError("Invalid field: expected 'string', got an empty string")}}(e),r(t),e.reduce(((e,r)=>(e[r]=t,e)),{})},e.createRemasteredFilter=function(){return new i({track:R,album:R})},e.createSpotifyFilter=function(){return new i({track:[R,S,w,A],album:[R,w,A,T,I]})},e.createTidalFilter=function(){return new i({track:[R,w,I,A],album:[R,w,I,A]})},e.createYouTubeFilter=function(){return new i({track:V})},e.decodeHtmlEntities=F,e.filterWithFilterRules=h,e.fixTrackSuffix=w,e.fixVariousArtists=function(e){return h(e,d)},e.normalizeFeature=x,e.removeAdditionalArtists=function(e){return h(e,$)},e.removeCleanExplicit=E,e.removeFeature=b,e.removeLive=A,e.removeParody=S,e.removeReissue=T,e.removeRemastered=R,e.removeVersion=I,e.removeZeroWidth=function(e){return e.replace(/[\u200B-\u200D\uFEFF]/g,"")},e.replaceNbsp=function(e){return e.replace(/\u00a0/g," ")},e.replaceSmartQuotes=function(e){return e.replace(/[\u2018\u2019]/g,"'").replace(/[\u201c\u201d]/g,'"')},e.youtube=V,Object.defineProperty(e,"__esModule",{value:!0})}));
